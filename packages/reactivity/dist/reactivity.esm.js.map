{
  "version": 3,
  "sources": ["../src/effect.ts", "../../shared/src/index.ts", "../src/baseHnadles.ts", "../src/reactive.ts"],
  "sourcesContent": ["export let activeEffect;\nclass ReactiveEffect {\n    public active = true;\n    public deps = [];\n    public parent = undefined;\n    constructor(public fn){}\n    run() {\n        if(!this.active) {\n            return this.fn(); // \u76F4\u63A5\u6267 \u884C\u6B64\u51FD\u6570\n        }\n        // \u5176\u5B83\u60C5\u51B5\u4E0B \u610F\u5473\u7740\u662F\u6FC0\u6D3B\u72B6\u6001\n        try{\n            // tree \u6811\u7236\u5B50\u5173\u7CFB\n            this.parent = activeEffect;\n            activeEffect = this;\n            return this.fn(); // \u4F1A\u53D6\u54CD\u5E94\u5F0F\u5C5E\u6027\n        }finally {\n            // \u65E0\u8BBA\u4EFB\u4F55\u60C5\u51B5\u4E0B\u90FD\u4F1A\u6267\u884C\n            activeEffect = this.parent;\n            this.parent = undefined;\n        }\n    }\n}\n// \u4F9D\u8D56\u6536\u96C6 \u5C31\u662F\u5C06\u5F53\u524D\u7684effect\u53D8\u6210\u5168\u5C40\u7684 \u7A0D\u540E\u53D6\u503C\u7684\u65F6\u5019\u53EF\u4EE5\u62FF\u5230\u8FD9\u4E2A\u5168\u5C40\u7684effect\nexport function effect(fn) {\n    const _effect = new ReactiveEffect(fn);\n    _effect.run(); // \u9ED8\u8BA4\u8BA9\u54CD\u5E94\u5F0F\u7684effect\u6267\u884C\u4E00\u6B21\n}\n\nconst targetMap = new WeakMap();\nexport function track(target, key) {\n    if(!activeEffect){\n        // \u53D6\u503C\u64CD\u4F5C\u6CA1\u6709\u53D1\u751F\u5728 effect \u4E2D\n        return;\n    }\n    let depsMap = targetMap.get(target);\n    if(!depsMap){\n        // weakMap\u4E2D\u7684key \u53EA\u80FD\u662F\u5BF9\u8C61\n        targetMap.set(target, (depsMap = new Map()));\n    }\n    let dep = depsMap.get(key);\n    if(!dep){\n        depsMap.set(key, (dep = new Set()));\n    }\n    let shouldTrack = !dep.has(activeEffect);\n    if(shouldTrack){\n        dep.add(activeEffect);\n        activeEffect.deps.push(dep); // \u540E\u7EED\u9700\u8981\u901A\u8FC7 effect \u6765\u6E05\u7406\u7684\u65F6\u5019\u53EF\u4EE5\u53BB\u4F7F\u7528\n    }\n}", "export const isObject = (obj) => {\n    return obj !== null && typeof obj === 'object'\n}", "import { track } from './effect';\nimport { ReactiveFlags } from './reactive';\n\nexport const mutableHnadlers = {\n    get(target, key, receiver) {\n        // \u7528\u6237\u53D6\u503C\u64CD\u4F5C\n        if (ReactiveFlags.IS_REACTIVE == key) {\n            return true;\n        }\n        track(target, key);\n        return Reflect.get(target, key, receiver); // \u5904\u7406this\u95EE\u9898\n    },\n    set(target, key, value, receiver) {\n        // \u7528\u6237\u8D4B\u503C\u7684\u64CD\u4F5C\n        return Reflect.set(target, key, value, receiver);\n    }\n\n}", "import { isObject } from '@vue/shared';\nimport { mutableHnadlers } from './baseHnadles';\n\nexport const enum ReactiveFlags {\n    IS_REACTIVE = \"__v_isReactive\",\n}\n\nconst reactiveMap = new WeakMap(); // key \u53EA\u80FD\u662F\u5BF9\u8C61\nexport function reactive(target) {\n    // \u4E0D\u5BF9\u975E\u5BF9\u8C61\u7684\u7C7B\u578B\u8FDB\u884C\u5904\u7406\n    if (!isObject(target)) {\n        return target;\n    }\n    if(target[ReactiveFlags.IS_REACTIVE]){\n        return target;\n    }\n    const exisitsProxy = reactiveMap.get(target);\n    if(exisitsProxy){\n        return exisitsProxy\n    }\n\n    // \u4EE3\u7406 \u901A\u8FC7\u4EE3\u7406\u5BF9\u8C61\u64CD\u4F5C\u5C5E\u6027\uFF0C\u4F1A\u53BB\u6E90\u5BF9\u8C61\u4E0A\u8FDB\u884C\u83B7\u53D6\n    const proxy = new Proxy(target, mutableHnadlers);\n    // \u7F13\u5B58\u4E00\u4E0B\uFF0C\u4EE3\u7406\u8FC7\u5F97\u5BF9\u8C61\uFF0C\u4E0B\u6B21\u8FDB\u884C\u4EE3\u7406\u7684\u65F6\u5019\u76F4\u63A5\u62FF\u51FA\u6765\u7528\u5373\u53EF\n    // target -> proxy\n    reactiveMap.set(target, proxy);\n    return proxy;\n}"],
  "mappings": ";AAAO,IAAI;AACX,IAAM,iBAAN,MAAqB;AAAA,EAIjB,YAAmB,IAAG;AAAH;AAHnB,SAAO,SAAS;AAChB,SAAO,OAAO,CAAC;AACf,SAAO,SAAS;AAAA,EACO;AAAA,EACvB,MAAM;AACF,QAAG,CAAC,KAAK,QAAQ;AACb,aAAO,KAAK,GAAG;AAAA,IACnB;AAEA,QAAG;AAEC,WAAK,SAAS;AACd,qBAAe;AACf,aAAO,KAAK,GAAG;AAAA,IACnB,UAAC;AAEG,qBAAe,KAAK;AACpB,WAAK,SAAS;AAAA,IAClB;AAAA,EACJ;AACJ;AAEO,SAAS,OAAO,IAAI;AACvB,QAAM,UAAU,IAAI,eAAe,EAAE;AACrC,UAAQ,IAAI;AAChB;AAEA,IAAM,YAAY,oBAAI,QAAQ;AACvB,SAAS,MAAM,QAAQ,KAAK;AAC/B,MAAG,CAAC,cAAa;AAEb;AAAA,EACJ;AACA,MAAI,UAAU,UAAU,IAAI,MAAM;AAClC,MAAG,CAAC,SAAQ;AAER,cAAU,IAAI,QAAS,UAAU,oBAAI,IAAI,CAAE;AAAA,EAC/C;AACA,MAAI,MAAM,QAAQ,IAAI,GAAG;AACzB,MAAG,CAAC,KAAI;AACJ,YAAQ,IAAI,KAAM,MAAM,oBAAI,IAAI,CAAE;AAAA,EACtC;AACA,MAAI,cAAc,CAAC,IAAI,IAAI,YAAY;AACvC,MAAG,aAAY;AACX,QAAI,IAAI,YAAY;AACpB,iBAAa,KAAK,KAAK,GAAG;AAAA,EAC9B;AACJ;;;ACjDO,IAAM,WAAW,CAAC,QAAQ;AAC7B,SAAO,QAAQ,QAAQ,OAAO,QAAQ;AAC1C;;;ACCO,IAAM,kBAAkB;AAAA,EAC3B,IAAI,QAAQ,KAAK,UAAU;AAEvB,8CAAiC,KAAK;AAClC,aAAO;AAAA,IACX;AACA,UAAM,QAAQ,GAAG;AACjB,WAAO,QAAQ,IAAI,QAAQ,KAAK,QAAQ;AAAA,EAC5C;AAAA,EACA,IAAI,QAAQ,KAAK,OAAO,UAAU;AAE9B,WAAO,QAAQ,IAAI,QAAQ,KAAK,OAAO,QAAQ;AAAA,EACnD;AAEJ;;;ACdO,IAAW,gBAAX,kBAAWA,mBAAX;AACH,EAAAA,eAAA,iBAAc;AADA,SAAAA;AAAA,GAAA;AAIlB,IAAM,cAAc,oBAAI,QAAQ;AACzB,SAAS,SAAS,QAAQ;AAE7B,MAAI,CAAC,SAAS,MAAM,GAAG;AACnB,WAAO;AAAA,EACX;AACA,MAAG,OAAO,qCAA2B;AACjC,WAAO;AAAA,EACX;AACA,QAAM,eAAe,YAAY,IAAI,MAAM;AAC3C,MAAG,cAAa;AACZ,WAAO;AAAA,EACX;AAGA,QAAM,QAAQ,IAAI,MAAM,QAAQ,eAAe;AAG/C,cAAY,IAAI,QAAQ,KAAK;AAC7B,SAAO;AACX;",
  "names": ["ReactiveFlags"]
}
